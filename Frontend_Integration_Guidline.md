# Frontend Integration Guidline


## Search API for "search" button
```javascript
/**
 * Asynchronously sends a search request to the Imitune backend API.
 * @param {number[]} embeddingVector - The embedding vector (an array of numbers) generated by the ONNX model.
 * @returns {Promise<Array>} - A promise that resolves to an array of search result objects on success, or an empty array on failure.
 */
async function searchSounds(embeddingVector) {
  // The actual deployed Vercel endpoint URL from the API specification.
  const apiUrl = 'https://imitune-backend-ek2udc5sb-chris-projects-3c0d9932.vercel.app/api/search';

  // Prepare the request body according to the API specification.
  const requestBody = {
    embedding: embeddingVector,
  };

  console.log("Sending search request to server...");

  try {
    // Send a POST request to the server using the fetch API.
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      // Convert the JavaScript object to a JSON string and send it in the body.
      body: JSON.stringify(requestBody),
    });

    // Check if the server returned an error response (e.g., 404, 500).
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || `Server responded with status: ${response.status}`);
    }

    // Parse the successful JSON response.
    const data = await response.json();

    // Return the array contained in the 'results' key, as per the specification.
    return data.results;

  } catch (error) {
    console.error("Failed to fetch search results:", error);
    // If an error occurs, return an empty array so the app doesn't crash.
    return [];
  }
}

// --- How to use this function (assuming it's inside a React component) ---

async function handleSearch() {
  // 1. Run the ONNX model to get the embedding vector (this part is simulated).
  const myEmbedding = [0.123, -0.456, 0.789, /* ... */];

  // 2. Call the searchSounds function and wait for the results.
  const searchResults = await searchSounds(myEmbedding);

  // 3. Display the received results on the screen or save them in the component's state.
  if (searchResults.length > 0) {
    console.log("Search successful!", searchResults);
    // Example: setSounds(searchResults);
  } else {
    console.log("Search failed or no results found.");
  }
}

// handleSearch(); // This function can be linked to a user event, like a button click.
```

## Feedback API for "submit" button
```javascript
/**
 * Asynchronously sends user feedback to the Imitune backend API.
 * @param {string} audioBase64 - The recorded audio as base64 encoded string with data URL prefix
 * @param {Array} freesoundUrls - Array of 3 freesound URLs (can include null values)
 * @param {Array} ratings - Array of 3 ratings ("like", "dislike", or null)
 * @returns {Promise<Object>} - A promise that resolves to the server response object on success, or null on failure
 */
async function submitFeedback(audioBase64, freesoundUrls, ratings) {
  // The actual deployed Vercel endpoint URL for feedback
  const apiUrl = 'https://imitune-backend-bptzlaz7e-chris-projects-3c0d9932.vercel.app/api/feedback';

  // Validate input arrays have exactly 3 elements
  if (freesoundUrls.length !== 3 || ratings.length !== 3) {
    console.error("Arrays must contain exactly 3 elements");
    return null;
  }

  // Prepare the request body according to the API specification
  const requestBody = {
    audioQuery: audioBase64,
    freesound_urls: freesoundUrls,
    ratings: ratings,
  };

  console.log("Sending feedback to server...");

  try {
    // Send a POST request to the server using the fetch API
    const response = await fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(requestBody),
    });

    // Check if the server returned an error response
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.error || `Server responded with status: ${response.status}`);
    }

    // Parse the successful JSON response
    const data = await response.json();
    console.log("Feedback submitted successfully:", data);
    return data;

  } catch (error) {
    console.error("Failed to submit feedback:", error);
    return null;
  }
}

// --- How to use this function (assuming it's inside a React component) ---

async function handleFeedbackSubmit() {
  // 1. Get the recorded audio as base64 string (this part depends on your recording implementation)
  // Example: const audioBase64 = await getRecordedAudioAsBase64();
  
  // 2. Prepare the feedback data
  const audioBase64 = "data:audio/webm;base64,..."; // 실제 base64 오디오 데이터로 대체
  const freesoundUrls = [
    "https://freesound.org/people/user/sounds/12345/",
    null,
    "https://freesound.org/people/user/sounds/67890/"
  ];
  const ratings = ["like", null, "dislike"];

  // 3. Call the submitFeedback function
  const feedbackResponse = await submitFeedback(audioBase64, freesoundUrls, ratings);

  // 4. Handle the response
  if (feedbackResponse) {
    console.log("Feedback submitted successfully!", feedbackResponse);
    // You might want to store the audioId for future reference
    const { audioId, audioUrl, metadataUrl } = feedbackResponse;
  } else {
    console.log("Feedback submission failed.");
  }
}

// handleFeedbackSubmit(); // This function can be linked to a submit button click
```